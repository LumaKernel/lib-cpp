
---
title: グレイコード (Gray Code)
---

(趣味記事)

グレイコードとは, 隣り合うコードのハミング距離が 1 であるようなコードのこと.

# 二進グレイコード

Reflected Binary Gray Code; RBGC とも.

例えば, 3桁のグレイコードは以下のようになる.

```
000
001
011
010
110
111
101
100
```

隣り合う数が, 1bit のみ異なっている (ハミング距離が 1) であることがわかります.

### 求め方

任意の桁数 $k$ について, $i$ 番目のグレイコードは $i$ から計算することができます.

// @ binary-to-gray

逆写像も存在し, 全単射であることがわかります.
つまり, 二進表現すべてを循環するということです.

逆変換は, 上の桁から, 左側のビットを自分に xor してやる, といことを繰り返してやればいいです. 一番上の桁は何もしません. つまり, 累積xorをするということですね.

// @new gray-to-binary

上記のようにかくと, シフト演算 $O(\log \log N)$ 回でできますね.

このように, 一気に計算するやつを, [SWAR (SIMD within a register)](https://en.wikipedia.org/wiki/SWAR){:target="_blank"}<!--_--> というらしい.

### 証明

`Gray(x) = x ^ (x >> 1)` とします.

`Gray(0) = 0`, `Gray((1 << n) - 1) = 1 << (n - 1)` はすぐわかります.

なので, 任意の桁数でループすることがわかります.

`Gray(i)` と `Gray(i + 1)` のハミング距離が 1 であることを示します.

いま, `i = ...x01...(n個)` であるとします. つまり, 二進表現で, `i = ...(任意)... (何かしら x) 0 111... (1が最後にn個続く)` という形をしているとしています.

`Gray(i + 0) = ...01...(n個) ^ (...x01...(n-1)個) = ... (0 ^ x)0...(n-1個)`  
`Gray(i + 1) = ...10...(n個) ^ (...x10...(n-1)個) = ... (1 ^ x)0...(n-1個)`  

となります. `...` は同じ数なので, ハミング距離は 1 です.

---

例えば, 

`Gray(...10111) = (...0111) ^ (...1011) = (...1000)`  
`Gray(...11000) = (...1000) ^ (...1100) = (...0000)`  

# その他のグレイコード

## n-進グレイコード

文字の数を $n$ 個に拡張します. $$\{0, 1, \cdots, (n - 1)\}$$ を使用できる文字として, $0$ と $n - 1$ も隣り合っているとします (円環).

3進2桁グレイコードの例

```
00
01
02
12
11
10
20
21
22
```

循環はしていないです.


# 参考

* [グレイコード - Wikipedia](https://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%AC%E3%82%A4%E3%82%B3%E3%83%BC%E3%83%89){:target="_blank"}<!--_-->
* [Gray code - Wikipedia (en) ](https://en.wikipedia.org/wiki/Gray_code){:target="_blank"}<!--_-->



